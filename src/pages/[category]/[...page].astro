---
import Pagination from "../../components/control/Pagination.astro";
import PostPage from "../../components/PostPage.astro";
import { PAGE_SIZE } from "../../constants/constants";
import MainGridLayout from "../../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../../utils/content-utils";
// import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }) {
  const posts = await getSortedPosts();

  // remove drafts first
  const publishedPosts = posts.filter(post => !post.data.draft);

  // get unique categories
  const categories = [
    ...new Set(publishedPosts.map(post => post.data.category))
  ];

  return categories.flatMap((category) => {
    const filtered = publishedPosts.filter(
      post => post.data.category === category
    );

    return paginate(filtered, {
      params: { category },
      pageSize: PAGE_SIZE
    });
  });
}
// https://github.com/withastro/astro/issues/6507#issuecomment-1489916992

const { page } = Astro.props;

const len = page.data.length;
---

<MainGridLayout>
    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
</MainGridLayout>